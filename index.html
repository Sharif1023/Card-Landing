<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fanned Cards + Modal Preview (Zoom/Pan/Thumbs)</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
:root{ --bg:#0f172a; --card:#fff; --border:#e2e8f0; }
.light{ --bg:#f8fafc; --card:#fff; --border:#e2e8f0; }

body{
  background:var(--bg);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:.35s;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans";
}

/* Fan Wrap */
.fan-wrap{ position:relative; width:100%; max-width:900px; height:460px; padding:0 10px; }

/* Card */
.fan-card{
  position:absolute; inset:0; margin:auto;
  width:72%; height:92%;
  background:var(--card);
  border-radius:28px;
  border:1px solid var(--border);
  box-shadow:0 40px 90px rgba(0,0,0,.35);
  overflow:hidden;
  transform-origin:50% 75%;
  transition: transform .6s ease, box-shadow .6s ease;
  cursor:pointer;
  user-select:none;
}
.fan-card:hover{
  z-index:10 !important;
  transform:translateY(-18px) scale(1.03) rotate(0deg)!important;
  box-shadow:0 50px 110px rgba(0,0,0,.42);
}
.fan-card:active{ transform:translateY(-10px) scale(1.01) rotate(0deg)!important; }

/* Positions */
.center{z-index:5;}
.l1{z-index:4;transform:translateX(-22%) rotate(-10deg) scale(.92);}
.l2{z-index:2;transform:translateX(-38%) rotate(-18deg) scale(.85);opacity:.82}
.r1{z-index:4;transform:translateX(22%) rotate(10deg) scale(.92);}
.r2{z-index:2;transform:translateX(38%) rotate(18deg) scale(.85);opacity:.82}

/* UI parts */
.topbar{
  height:46px; display:flex; align-items:center; justify-content:space-between;
  padding:0 16px; backdrop-filter:blur(12px); background:#ffffffcc;
  border-bottom:1px solid var(--border);
}
.dots{display:flex;gap:7px}
.dot{width:11px;height:11px;border-radius:999px}

.hero-img{
  margin:18px; height:140px; border-radius:22px; overflow:hidden;
  border:1px solid var(--border); background:#0b1220;
}
.hero-img img{ width:100%; height:100%; object-fit:cover; display:block; }

.lines{ margin:14px 18px; display:grid; gap:10px; }
.line{ height:10px; background:#e5e7eb; border-radius:999px; }
.w1{width:60%} .w2{width:45%} .w3{width:80%}

.mini-cards{ margin:16px 18px; display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
.mini{ height:70px; border-radius:16px; overflow:hidden; border:1px solid var(--border); background:#0b1220; }
.mini img{ width:100%; height:100%; object-fit:cover; display:block; }

/* Toggle */
.toggle{
  position:fixed; top:18px; right:18px;
  background:#fff; border-radius:999px; padding:7px 14px;
  font-size:13px; cursor:pointer; box-shadow:0 10px 30px rgba(0,0,0,.2);
  user-select:none;
}

/* Modal */
.modal{
  position:fixed; inset:0; display:none; align-items:center; justify-content:center;
  padding:18px; z-index:9999;
}
.modal.open{ display:flex; }
.modal-backdrop{
  position:absolute; inset:0;
  background: rgba(2,6,23,.72);
  backdrop-filter: blur(8px);
}
.modal-panel{
  position:relative;
  width:min(1060px, 96vw);
  max-height: 92vh;
  border-radius: 22px;
  border: 1px solid rgba(226,232,240,.18);
  background: rgba(255,255,255,.92);
  box-shadow: 0 60px 140px rgba(0,0,0,.55);
  overflow:hidden;
  transform: translateY(8px) scale(.98);
  opacity: 0;
  transition: .18s ease;
}
.modal.open .modal-panel{ transform: translateY(0) scale(1); opacity:1; }

.modal-head{
  display:flex; align-items:center; justify-content:space-between; gap: 10px;
  padding: 12px 14px;
  border-bottom: 1px solid rgba(226,232,240,.7);
  background: rgba(255,255,255,.65);
}
.modal-title{ font-weight: 900; color: #0f172a; font-size: 14px; letter-spacing:.02em; }
.modal-actions{ display:flex; flex-wrap:wrap; gap:8px; }

.btn{
  border:1px solid rgba(226,232,240,1);
  background:#fff;
  padding: 8px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 800;
  color:#0f172a;
  cursor:pointer;
}
.btn:hover{ background:#f8fafc; }
.btn.primary{ border-color: rgba(2,132,199,.25); background:#0284c7; color:#fff; }
.btn.primary:hover{ background:#0369a1; }

.modal-body{
  display:grid;
  grid-template-columns: 1.25fr .75fr;
  gap: 14px;
  padding: 14px;
}

/* Preview (zoom/pan) */
.preview{
  border-radius: 18px;
  overflow:hidden;
  border:1px solid rgba(226,232,240,.9);
  background:#0b1220;
  min-height: 320px;
  position:relative;
}
.preview-viewport{
  position:absolute; inset:0;
  cursor: grab;
}
.preview-viewport.grabbing{ cursor: grabbing; }
.preview-img{
  position:absolute;
  left:50%; top:50%;
  transform: translate(-50%,-50%) scale(1);
  transform-origin: center center;
  will-change: transform;
  user-select:none;
  pointer-events:none;
  max-width:none; /* allow zoom */
  max-height:none;
}

/* Thumbnail strip */
.thumbs{
  display:flex;
  gap:10px;
  overflow:auto;
  padding: 10px 12px 12px;
  border-top: 1px solid rgba(226,232,240,.7);
  background: rgba(255,255,255,.65);
}
.thumb{
  width: 92px;
  height: 58px;
  border-radius: 14px;
  overflow:hidden;
  border:1px solid rgba(226,232,240,.9);
  background:#0b1220;
  cursor:pointer;
  flex: 0 0 auto;
  opacity:.9;
  transition:.15s ease;
}
.thumb:hover{ transform: translateY(-2px); opacity:1; }
.thumb.active{ outline: 3px solid rgba(2,132,199,.35); opacity:1; }
.thumb img{ width:100%; height:100%; object-fit:cover; display:block; }

.meta{
  border-radius: 18px;
  border:1px solid rgba(226,232,240,.9);
  background:#fff;
  padding: 14px;
}
.meta .k{ font-size:12px; color:#475569; font-weight:800; }
.meta .v{ margin-top:6px; font-size:13px; color:#0f172a; font-weight:900; }
.meta .desc{ margin-top:10px; font-size:13px; color:#334155; line-height:1.55; }
.meta .row{ display:grid; gap:10px; margin-top:14px; }

.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border:1px solid rgba(226,232,240,1);
  border-radius: 14px;
  background:#fff;
  font-size:12px;
  font-weight:900;
  color:#0f172a;
}

@media(max-width:860px){
  .modal-body{ grid-template-columns: 1fr; }
}
@media(max-width:768px){
  .fan-wrap{height:360px}
  .fan-card{width:92%}
  .l2,.r2{display:none}
}
</style>
</head>

<body>

<div class="toggle" id="themeBtn">üåô / ‚òÄÔ∏è</div>

<div class="fan-wrap" id="fan">

  <!-- LEFT BACK -->
  <div class="fan-card l2" data-title="Restaurant Landing" data-img="https://picsum.photos/1400/900?random=11">
    <div class="topbar">
      <div class="dots">
        <span class="dot bg-red-400"></span><span class="dot bg-yellow-400"></span><span class="dot bg-green-400"></span>
      </div>
      <span class="text-xs text-slate-500">Template</span>
    </div>
    <div class="hero-img"><img src="https://picsum.photos/700/500?random=11" alt=""></div>
    <div class="lines"><div class="line w3"></div><div class="line w1"></div></div>
    <div class="mini-cards">
      <div class="mini"><img src="https://picsum.photos/220?random=111" alt=""></div>
      <div class="mini"><img src="https://picsum.photos/220?random=112" alt=""></div>
      <div class="mini"><img src="https://picsum.photos/220?random=113" alt=""></div>
    </div>
  </div>

  <!-- LEFT -->
  <div class="fan-card l1" data-title="Interior Design Landing" data-img="https://picsum.photos/1400/900?random=22">
    <div class="topbar">
      <div class="dots">
        <span class="dot bg-red-400"></span><span class="dot bg-yellow-400"></span><span class="dot bg-green-400"></span>
      </div>
      <span class="text-xs text-slate-500">Landing</span>
    </div>
    <div class="hero-img"><img src="https://picsum.photos/700/500?random=22" alt=""></div>
    <div class="lines"><div class="line w1"></div><div class="line w3"></div></div>
    <div class="mini-cards">
      <div class="mini"><img src="https://picsum.photos/220?random=221" alt=""></div>
      <div class="mini"><img src="https://picsum.photos/220?random=222" alt=""></div>
      <div class="mini"><img src="https://picsum.photos/220?random=223" alt=""></div>
    </div>
  </div>

  <!-- CENTER -->
  <div class="fan-card center" data-title="Living Space Guide" data-img="https://picsum.photos/1400/900?random=33">
    <div class="topbar">
      <div class="dots">
        <span class="dot bg-red-400"></span><span class="dot bg-yellow-400"></span><span class="dot bg-green-400"></span>
      </div>
      <span class="text-xs text-slate-500">Preview</span>
    </div>

    <div class="text-center pt-5">
      <p class="text-xs tracking-widest text-slate-500 font-semibold">YOUR ONLINE GUIDE</p>
      <h3 class="text-xl font-extrabold mt-1">PERFECT <span class="text-sky-600">LIVING SPACE</span></h3>
      <p class="text-xs text-slate-500 mt-1">Click to preview</p>
    </div>

    <div class="hero-img"><img src="https://picsum.photos/700/500?random=33" alt=""></div>
    <div class="lines"><div class="line w3"></div><div class="line w2"></div></div>
    <div class="mini-cards">
      <div class="mini"><img src="https://picsum.photos/220?random=331" alt=""></div>
      <div class="mini"><img src="https://picsum.photos/220?random=332" alt=""></div>
      <div class="mini"><img src="https://picsum.photos/220?random=333" alt=""></div>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="fan-card r1" data-title="Real Estate Listing" data-img="https://picsum.photos/1400/900?random=44">
    <div class="topbar">
      <div class="dots">
        <span class="dot bg-red-400"></span><span class="dot bg-yellow-400"></span><span class="dot bg-green-400"></span>
      </div>
      <span class="text-xs text-slate-500">Showcase</span>
    </div>
    <div class="hero-img"><img src="https://picsum.photos/700/500?random=44" alt=""></div>
    <div class="lines"><div class="line w2"></div><div class="line w1"></div></div>
    <div class="mini-cards">
      <div class="mini"><img src="https://picsum.photos/220?random=441" alt=""></div>
      <div class="mini"><img src="https://picsum.photos/220?random=442" alt=""></div>
      <div class="mini"><img src="https://picsum.photos/220?random=443" alt=""></div>
    </div>
  </div>

  <!-- RIGHT BACK -->
  <div class="fan-card r2" data-title="Auto Service Landing" data-img="https://picsum.photos/1400/900?random=55">
    <div class="topbar">
      <div class="dots">
        <span class="dot bg-red-400"></span><span class="dot bg-yellow-400"></span><span class="dot bg-green-400"></span>
      </div>
      <span class="text-xs text-slate-500">Portfolio</span>
    </div>
    <div class="hero-img"><img src="https://picsum.photos/700/500?random=55" alt=""></div>
    <div class="lines"><div class="line w1"></div><div class="line w3"></div></div>
    <div class="mini-cards">
      <div class="mini"><img src="https://picsum.photos/220?random=551" alt=""></div>
      <div class="mini"><img src="https://picsum.photos/220?random=552" alt=""></div>
      <div class="mini"><img src="https://picsum.photos/220?random=553" alt=""></div>
    </div>
  </div>

</div>

<!-- MODAL -->
<div class="modal" id="modal" aria-hidden="true">
  <div class="modal-backdrop" id="modalBackdrop"></div>

  <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-head">
      <div class="modal-title" id="modalTitle">Preview</div>

      <div class="modal-actions">
        <button class="btn" id="prevBtn">‚óÄ Prev</button>
        <button class="btn" id="nextBtn">Next ‚ñ∂</button>

        <span class="pill" title="Mouse wheel to zoom; drag to pan">
          Zoom:
          <button class="btn" id="zoomOutBtn" style="padding:6px 10px;">‚àí</button>
          <button class="btn" id="zoomInBtn" style="padding:6px 10px;">+</button>
          <button class="btn" id="resetBtn" style="padding:6px 10px;">Reset</button>
        </span>

        <button class="btn" id="downloadBtn">Download</button>
        <button class="btn primary" id="closeBtn">Close ‚úï</button>
      </div>
    </div>

    <div class="modal-body">
      <div class="preview" id="previewBox">
        <div class="preview-viewport" id="viewport"></div>
        <img class="preview-img" id="modalImg" src="" alt="Preview">
      </div>

      <div class="meta">
        <p class="k">Template name</p>
        <p class="v" id="metaName">‚Äî</p>

        <p class="k" style="margin-top:12px;">Details</p>
        <p class="desc" id="metaDesc">
          Mouse wheel ‡¶¶‡¶ø‡ßü‡ßá zoom, ‡¶Ü‡¶∞ mouse ‡¶ß‡¶∞‡ßá drag ‡¶ï‡¶∞‡ßá pan ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§
        </p>

        <div class="row">
          <button class="btn" id="openImgBtn">Open Image</button>
          <button class="btn" id="copyLinkBtn">Copy Image URL</button>
        </div>

        <p class="k" style="margin-top:14px;">Shortcuts</p>
        <p class="desc">
          <b>Esc</b> close ‚Ä¢ <b>‚Üê/‚Üí</b> prev/next ‚Ä¢ <b>+</b>/<b>-</b> zoom ‚Ä¢ <b>0</b> reset
        </p>
      </div>
    </div>

    <div class="thumbs" id="thumbStrip"></div>
  </div>
</div>

<script>
/* ===== Theme ===== */
document.getElementById("themeBtn").addEventListener("click", () => {
  document.body.classList.toggle("light");
});

/* ===== Auto rotate (paused when modal open) ===== */
const fan = document.getElementById("fan");
let rotateTimer = null;
function startRotate(){
  stopRotate();
  rotateTimer = setInterval(() => {
    if (document.getElementById("modal").classList.contains("open")) return;
    fan.appendChild(fan.children[0]);
  }, 3500);
}
function stopRotate(){ if (rotateTimer) clearInterval(rotateTimer); rotateTimer = null; }
startRotate();

/* ===== Modal + Preview data ===== */
const modal = document.getElementById("modal");
const modalImg = document.getElementById("modalImg");
const modalTitle = document.getElementById("modalTitle");
const metaName = document.getElementById("metaName");
const metaDesc = document.getElementById("metaDesc");
const thumbStrip = document.getElementById("thumbStrip");

const cards = Array.from(document.querySelectorAll(".fan-card"));
const items = cards.map((c, i) => ({
  index: i,
  title: c.dataset.title || `Preview ${i+1}`,
  img: c.dataset.img || ""
}));

let activeIndex = 0;

/* ===== Zoom / Pan state ===== */
let scale = 1;
let tx = 0;
let ty = 0;
let isDragging = false;
let startX = 0, startY = 0;
let startTx = 0, startTy = 0;

const viewport = document.getElementById("viewport");
const previewBox = document.getElementById("previewBox");

function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

function applyTransform(){
  // translate from centered image: translate(-50%,-50%) scale + pan offsets
  modalImg.style.transform = `translate(calc(-50% + ${tx}px), calc(-50% + ${ty}px)) scale(${scale})`;
}

function resetView(){
  scale = 1; tx = 0; ty = 0;
  applyTransform();
}

function zoomTo(newScale, cx=null, cy=null){
  const prev = scale;
  scale = clamp(newScale, 0.6, 4);

  // If zoom around cursor: adjust translation to keep point under cursor stable
  if (cx !== null && cy !== null){
    const rect = previewBox.getBoundingClientRect();
    const px = cx - rect.left - rect.width/2;
    const py = cy - rect.top  - rect.height/2;

    // scale ratio
    const r = scale / prev;
    tx = tx + px - px * r;
    ty = ty + py - py * r;
  }
  applyTransform();
}

function openModalByIndex(i){
  activeIndex = (i + items.length) % items.length;
  const it = items[activeIndex];

  modalTitle.textContent = it.title;
  metaName.textContent = it.title;
  metaDesc.textContent = `Preview of "${it.title}". Wheel to zoom, drag to pan.`;
  modalImg.src = it.img;

  // build thumbs once, but set active state each open
  renderThumbs();
  setActiveThumb();

  modal.classList.add("open");
  modal.setAttribute("aria-hidden","false");
  document.body.style.overflow = "hidden";

  resetView();
}

function closeModal(){
  modal.classList.remove("open");
  modal.setAttribute("aria-hidden","true");
  document.body.style.overflow = "";
  isDragging = false;
  viewport.classList.remove("grabbing");
}

/* open modal on card click */
cards.forEach((card, idx) => card.addEventListener("click", () => openModalByIndex(idx)));

/* modal buttons */
document.getElementById("closeBtn").addEventListener("click", closeModal);
document.getElementById("modalBackdrop").addEventListener("click", closeModal);
document.getElementById("prevBtn").addEventListener("click", () => openModalByIndex(activeIndex - 1));
document.getElementById("nextBtn").addEventListener("click", () => openModalByIndex(activeIndex + 1));

/* utility buttons */
document.getElementById("openImgBtn").addEventListener("click", () => modalImg.src && window.open(modalImg.src, "_blank"));
document.getElementById("copyLinkBtn").addEventListener("click", async () => {
  try{
    await navigator.clipboard.writeText(modalImg.src || "");
    const btn = document.getElementById("copyLinkBtn");
    const old = btn.textContent;
    btn.textContent = "Copied ‚úÖ";
    setTimeout(()=> btn.textContent = old, 900);
  }catch(e){
    alert("Copy failed (clipboard blocked).");
  }
});

/* Download */
document.getElementById("downloadBtn").addEventListener("click", () => {
  if (!modalImg.src) return;
  const a = document.createElement("a");
  a.href = modalImg.src;
  a.download = (items[activeIndex].title || "preview").replace(/\s+/g,"_") + ".jpg";
  document.body.appendChild(a);
  a.click();
  a.remove();
});

/* Zoom controls */
document.getElementById("zoomInBtn").addEventListener("click", () => zoomTo(scale + 0.2));
document.getElementById("zoomOutBtn").addEventListener("click", () => zoomTo(scale - 0.2));
document.getElementById("resetBtn").addEventListener("click", resetView);

/* Wheel zoom */
previewBox.addEventListener("wheel", (e) => {
  if (!modal.classList.contains("open")) return;
  e.preventDefault();
  const delta = e.deltaY > 0 ? -0.18 : 0.18;
  zoomTo(scale + delta, e.clientX, e.clientY);
}, { passive:false });

/* Drag / pan */
viewport.addEventListener("mousedown", (e) => {
  if (!modal.classList.contains("open")) return;
  isDragging = true;
  startX = e.clientX; startY = e.clientY;
  startTx = tx; startTy = ty;
  viewport.classList.add("grabbing");
});
window.addEventListener("mousemove", (e) => {
  if (!isDragging) return;
  tx = startTx + (e.clientX - startX);
  ty = startTy + (e.clientY - startY);
  applyTransform();
});
window.addEventListener("mouseup", () => {
  isDragging = false;
  viewport.classList.remove("grabbing");
});

/* Keyboard shortcuts */
document.addEventListener("keydown", (e) => {
  if (!modal.classList.contains("open")) return;

  if (e.key === "Escape") closeModal();
  if (e.key === "ArrowLeft") openModalByIndex(activeIndex - 1);
  if (e.key === "ArrowRight") openModalByIndex(activeIndex + 1);

  if (e.key === "+" || e.key === "=") zoomTo(scale + 0.2);
  if (e.key === "-" || e.key === "_") zoomTo(scale - 0.2);
  if (e.key === "0") resetView();
});

/* Thumbnails */
function renderThumbs(){
  if (thumbStrip.dataset.ready === "1") return; // build once
  thumbStrip.innerHTML = items.map((it, i) => `
    <div class="thumb" data-i="${i}" title="${it.title}">
      <img src="${it.img}" alt="${it.title}">
    </div>
  `).join("");
  thumbStrip.dataset.ready = "1";

  thumbStrip.addEventListener("click", (e) => {
    const t = e.target.closest(".thumb");
    if (!t) return;
    const i = Number(t.dataset.i);
    openModalByIndex(i);
  });
}
function setActiveThumb(){
  const all = thumbStrip.querySelectorAll(".thumb");
  all.forEach(el => el.classList.remove("active"));
  const current = thumbStrip.querySelector(`.thumb[data-i="${activeIndex}"]`);
  if (current){
    current.classList.add("active");
    // ensure visible
    current.scrollIntoView({ behavior:"smooth", block:"nearest", inline:"center" });
  }
}
modalImg.addEventListener("load", () => { resetView(); setActiveThumb(); });
</script>

</body>
</html>
